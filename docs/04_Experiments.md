# 04_Experiments：A/B実験仕様

成果物ID：EXP-1 / Version：1.1

最終更新：2026-02-08

目的：主要な設計要素が、学習開始と継続に寄与しているかを最小実験で検証する

対象：モバイルアプリとWeb

割付単位：ユーザー単位で固定割付

期間：原則 14日運用。初回体験の検証のみ最短 7日も可

参照：PRIN-1、PRD-1、DESIGN-1、METRICS-1

---

## 目次

0. 実験の共通ルール
1. 統計的基準とサンプルサイズ設計
2. 早期停止ルール
3. 実験一覧
4. 実装済み実験詳細（MVP）
5. 実験詳細（X-001〜X-005）
6. 実験運用メモ
7. 関連ドキュメント
8. 更新履歴

---

## 0. 実験の共通ルール

- ユーザー単位で固定割付。途中で群を跨がない
- UIの差分は1要素に限定。複合変更は避ける
- 初回系は新規ユーザーのみ。復帰系は休眠ユーザーのみ
- 成功判定は先行指標で早期確認し、遅行指標で確定する
- 推奨ログ
    - app_open
    - today_view
    - focus_start
    - focus_complete
    - recall_view
    - recall_submit
    - recall_skip
    - log_submit
    - propose_accept
    - propose_replace
    - propose_rest
    - stuck_detect
    - rescue_view
    - rescue_apply
    - return_view
    - return_start
    - notification_send
    - notification_open

---

## 1. 統計的基準とサンプルサイズ設計

### 1-1. 統計的有意性の基準

- **有意水準（α）**: 5%（p < 0.05）
- **検出力（1-β）**: 80%（β = 20%）
- **最小検出効果（MDE: Minimum Detectable Effect）**: 指標ごとに設定（下表参照）

### 1-2. 指標ごとのMDEとサンプルサイズ

以下は、MVP段階で実用的なサンプルサイズを前提とした設定（ASSUMPTION）。

| 指標 | ベースライン | MDE | 必要サンプル（群あたり） | 備考 |
|---|---|---|---|---|
| Time-to-start（p75） | 40秒 | -10秒（-25%） | 約800 | 連続値、t検定 |
| 初回完了率 | 60% | +10%pt | 約780 | 二値、z検定 |
| 提案受諾率 | 70% | +5%pt | 約1570 | 二値、z検定 |
| Day2 継続率 | 40% | +5%pt | 約1570 | 二値、z検定 |
| Day7 継続率 | 25% | +5%pt | 約1230 | 二値、z検定 |
| 詰まり救済採用率 | 50% | +10%pt | 約780 | 二値、z検定 |
| 復帰後開始率 | 30% | +10%pt | 約650 | 二値、z検定 |

※ サンプルサイズは両側検定、α=0.05、検出力80%を前提に算出

### 1-3. サンプルサイズ計算ツール

実験開始前に以下のツールで再計算を推奨：
- Evan's Awesome A/B Tools: https://www.evanmiller.org/ab-testing/
- Optimizely Sample Size Calculator

### 1-4. 複数比較の補正

同一実験で3つ以上の指標を主要評価項目とする場合、Bonferroni補正を適用する（α' = α / k、kは比較数）。

参照：METRICS-1

---

## 2. 早期停止ルール

### 2-1. 早期成功停止

以下の条件を**すべて**満たす場合、実験を早期成功終了できる：

1. **統計的有意性**: 主要指標が p < 0.01 で有意に改善
2. **実用的改善**: MDEを上回る効果量
3. **Guardrail安全**: すべてのGuardrail指標が閾値内
4. **最小期間**: 7日以上経過
5. **最小サンプル**: 必要サンプルの50%以上を達成

### 2-2. 早期失敗停止

以下の条件を**いずれか**満たす場合、実験を早期失敗終了する：

1. **統計的有意な悪化**: 主要指標が p < 0.05 で有意に悪化
2. **Guardrail違反**: クリティカルなGuardrail指標が閾値を超過
3. **実装バグ**: 実験群で重大なバグが発見された
4. **ユーザー苦情**: 定性フィードバックで重大な問題が報告された

### 2-3. Peek（途中確認）のルール

- **確認頻度**: 最大週2回まで（火曜・金曜など）
- **p値調整**: Sequential testing を用いるか、保守的な有意水準（p < 0.01）を使用
- **記録**: すべての途中確認結果を 05_Decisions.md に記録

参照：METRICS-1 § 8 アラート設計

---

## 3. 実験一覧

- X-001 今日の一つ提示に選択権を付ける
- X-002 初回5分で価値が分かる完了導線
- X-003 疲労日短縮メニューの提示方法
- X-004 詰まり救済の短さと選択肢数
- X-005 復帰時の提示情報を最小にする

---

## 5. 実験詳細（X-001〜X-005）

以下は将来実装予定の実験の設計案。Prompt 6で実装した実験（X-001/X-002）とは別の内容。

---

## X-001 今日の一つ提示に選択権を付ける（将来実装予定）

参照：P-101、SD-1 D-001

目的：迷いを減らし、開始までの時間と継続への影響を確認する

### 対象

- 既存ユーザーと新規ユーザーの両方
- 初回ユーザーは別途 X-002 を優先し、重複割付は避ける

### UI差分

- A：今日の一つを提示。行動は「これで進む」のみ
- B：今日の一つを提示。行動は3つ
    - これで進む
    - 別案にする
    - 今日は休む

### 割付

- 50% / 50%
- ユーザー単位で固定

### 期間

- 14日

### 主要指標

- 先行指標
    - Time-to-start
    - 提案受諾率 propose_accept
    - 別案率 propose_replace
    - 休む率 propose_rest
- 遅行指標
    - Day2継続
    - Day7継続
    - 週目標達成率

### 成功条件

- Time-to-start がBで改善
- Day2 が悪化しない
- 別案率が上がっても Day7 が悪化しない

### 失敗条件

- Bで propose_replace が高く、Day2 または Day7 が悪化
- propose_rest が増え、開始率が低下

---

## X-002 初回5分で価値が分かる完了導線

参照：P-103、SD-1 D-002

目的：初回で価値理解と最初の完了を作り、翌日以降の継続に繋がるか検証する

### 対象

- 新規ユーザーのみ

### UI差分

- A：初回に説明中心。任意で学習を開始
- B：初回は実行中心
    - 今日の一つを提示
    - 1分または3分の集中を推奨
    - 想起は1問のみ
    - 証拠ログを1行で完了
    - 完了画面で「今日の証拠」と「次の一手」を1つ提示

### 割付

- 50% / 50%
- ユーザー単位で固定

### 期間

- 7日から14日

### 主要指標

- 先行指標
    - 初回完了率 初回フルループ完了
    - 初回の理解度 1問アンケート
    - 初回のTime-to-start
- 遅行指標
    - Day2継続
    - Day7継続

### 成功条件

- 初回完了率がBで改善
- Day2 がBで改善
- 初回アンケートの理解度がBで改善

### 失敗条件

- 初回完了率が上がるが Day2 が下がる
- 初回で負担が増え、Time-to-start が悪化

---

## X-003 疲労日短縮メニューの提示方法

参照：P-102、SD-1 D-003

目的：疲労が強い日に短縮で完了できる導線が、離脱を抑えるか検証する

### 対象

- 既存ユーザー
- 疲労日推定に該当したユーザー
    - 夜間利用が多い
    - 直近で完了が連続未達
    - 1分または3分を選ぶ傾向

### UI差分

- A：通常の選択肢のみ
- B：疲労日短縮の提案を表示
    - 1分または3分を先頭に固定
    - 想起は1問またはスキップ可
    - 文言は短く事実ベース

### 割付

- 疲労日推定に該当したタイミングで 50% / 50%
- ユーザー単位で固定

### 期間

- 14日

### 主要指標

- 先行指標
    - 疲労日での完了率
    - 疲労日でのスキップ率 recall_skip
    - 疲労日でのTime-to-start
- 遅行指標
    - 30日継続の前兆としての 7日連続利用率
    - Day7継続

### 成功条件

- 疲労日完了率がBで改善
- recall_skip が増えても Day7 が悪化しない

### 失敗条件

- Bで学習価値が弱く感じられ、Day7 が悪化
- 提示が増えて迷いが増え、Time-to-start が悪化

---

## X-004 詰まり救済の短さと選択肢数

参照：P-104、SD-1 D-004

目的：詰まり時の介入が短いほど再開率が上がるか検証する

### 対象

- 詰まり検知に該当したユーザー
    - 想起の連続失敗
    - 集中の中断が連続
    - 休む選択が連続

### UI差分

- A：詰まり時に説明と提案が多い救済ビュー
- B：詰まり時に短い救済ビュー
    - 原因は最大3つ
    - 打ち手も最大3つ
    - 長文は出さない
    - 選択後は今日か集中に戻す

### 割付

- 詰まり検知イベント発生時に 50% / 50%
- ユーザー単位で固定

### 期間

- 14日

### 主要指標

- 先行指標
    - 救済ビュー到達率 rescue_view
    - 救済採用率 rescue_apply
    - 救済後の再開率 直後の focus_start
- 遅行指標
    - 7日継続
    - 週目標達成率

### 成功条件

- 救済採用率がBで改善
- 救済後の focus_start がBで改善
- Day7 が悪化しない

### 失敗条件

- Bが短すぎて理解できず rescue_apply が下がる
- 介入が不適切で離脱が増える

---

## X-005 復帰時の提示情報を最小にする

参照：P-110、SD-1 D-010

目的：休眠後の復帰で、情報を最小化すると再開率が上がるか検証する

### 対象

- 休眠ユーザー
    - 7日以上未ログイン
    - 14日以上未ログインの層も分けて見る

### UI差分

- A：復帰時に進捗と未消化を多く見せる
- B：復帰時に最小提示
    - 前回の要点 1行
    - 今日の一つ 1つ
    - 未消化は見せない。必要なら圧縮して後から

### 割付

- 50% / 50%
- ユーザー単位で固定

### 期間

- 14日

### 主要指標

- 先行指標
    - 復帰後の開始率 return_start
    - 復帰初回の完了率
    - 復帰後のTime-to-start
- 遅行指標
    - 復帰後Day2
    - 30日復活率

### 成功条件

- 復帰後の開始率がBで改善
- 復帰後Day2 がBで改善

### 失敗条件

- Bで状況が分からず不安が増え、開始率が下がる
- 復帰後の完了率が下がる

---

## 4. 実装済み実験詳細（MVP）

本セクションは、Prompt 6で実装した2つの実験の詳細を記載する。

### X-001：Today提示の強度（実装済み）

**参照**: P-101、SD-1 D-001

**目的**: Today提示の文言の強さが、受諾率と継続に影響するか検証する

**対象**:
- すべてのユーザー（新規・既存）

**UI差分**:
- **Control群**: 「これで進める」（中立的な表現）
- **Treatment群**: 「これにする」（弱い表現、選択権を強調）

**割付**:
- 50% / 50%
- ユーザー単位で固定（ハッシュベース）

**期間**:
- 2026-02-10 〜 2026-02-24（14日間）

**主要指標**:
- **先行指標**（週次確認）
  - Time-to-start（p75）: 40秒 → 30秒（-25%改善）
  - 提案受諾率（today_offer_accept）: 70% → 75%（+5%pt）
- **遅行指標**（確定判断）
  - Day2継続率: 40% → 45%（+5%pt）
  - Day7継続率: 25% → 30%（+5%pt）

**成功条件**:
以下をすべて満たす場合、Treatment群を採用
1. Time-to-start が Treatment群で統計的に有意に改善（p < 0.05）
2. 提案受諾率が Treatment群で維持または改善
3. Day2継続率が Treatment群で悪化しない（非劣性）
4. Day7継続率が Treatment群で悪化しない（非劣性）

**失敗条件**:
以下のいずれかを満たす場合、Control群に戻す
1. 提案受諾率が Treatment群で有意に低下（p < 0.05）
2. Day2継続率が Treatment群で有意に低下（p < 0.05）
3. Day7継続率が Treatment群で有意に低下（p < 0.05）

**実装ファイル**:
- `packages/web/src/services/experimentService.ts`（実験管理サービス）
- `packages/web/src/components/TodayCard.tsx`（UI差分実装）
- `packages/web/src/pages/TodayPage.tsx`（割付取得）

**Guardrail指標**:
- 休む率（today_offer_skip）: +10%pt以内
- Focus完了率（focus_complete）: -5%pt以内

---

### X-002：Recallスキップ導線の強調（実装済み）

**参照**: P-105、SD-1 D-002

**目的**: Recallのスキップ導線を強調することで、強制感を減らし継続率が改善するか検証する

**対象**:
- 新規ユーザーのみ（初回体験を対象）

**UI差分**:
- **Control群**: スキップボタンは下線テキスト（目立たない）
- **Treatment群**: スキップボタンは通常ボタン（青枠で強調）

**割付**:
- 50% / 50%
- ユーザー単位で固定（ハッシュベース）

**期間**:
- 2026-02-10 〜 2026-02-24（14日間）

**主要指標**:
- **先行指標**（週次確認）
  - Recallスキップ率（recall_skipped）: 20% → 30%（+10%pt）
  - Focus完了率（focus_complete）: 80% → 80%（維持）
- **遅行指標**（確定判断）
  - Day2継続率: 40% → 45%（+5%pt）
  - 初回完了率（day1_complete）: 60% → 70%（+10%pt）

**成功条件**:
以下をすべて満たす場合、Treatment群を採用
1. Recallスキップ率が Treatment群で上昇（予想通り）
2. 初回完了率が Treatment群で維持または改善
3. Day2継続率が Treatment群で統計的に有意に改善（p < 0.05）

**失敗条件**:
以下のいずれかを満たす場合、Control群に戻す
1. 初回完了率が Treatment群で有意に低下（p < 0.05）
2. Day2継続率が Treatment群で悪化（スキップしても継続しない）
3. Focus完了率が Treatment群で有意に低下（p < 0.05）

**実装ファイル**:
- `packages/web/src/services/experimentService.ts`（実験管理サービス）
- `packages/web/src/pages/RecallPage.tsx`（UI差分実装と割付取得）

**Guardrail指標**:
- Focus完了率（focus_complete）: -5%pt以内
- Recall正答率（recall_answered の is_correct=true）: -10%pt以内

---

## 6. 実験運用メモ

- 分析の最小単位
    - 新規ユーザー
    - 既存ユーザー
    - 休眠ユーザー
- まず先行指標で週次判断し、遅行指標で確定する
- 大きな変更は 05_Decisions に意思決定として残す
- 実験結果は必ず 05_Decisions.md に記録し、次の実験設計に反映する

---

## 7. 関連ドキュメント

- **00_Principles.md**：サービス設計原則
- **01_PRD.md**：プロダクト要求仕様
- **02_Design.md**：UX設計仕様
- **03_Metrics.md**：計測定義とイベント設計
- **05_Decisions.md**：意思決定ログ（実験結果の記録先）

---

## 8. 更新履歴

| 日付 | Version | 変更内容 | 担当者 |
|---|---|---|---|
| 2026-02-08 | 1.2 | 実装済み実験詳細（X-001/X-002）を追加、章番号の再調整 | - |
| 2026-02-08 | 1.1 | 統計的基準、サンプルサイズ設計、早期停止ルールの追加、章番号の修正、目次追加 | - |
| - | 1.0 | 初版作成 | - |